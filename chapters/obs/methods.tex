% !TeX root = ../../thesis.tex

\subsubsection{Materials}
Data was retrospectively collected from nine different public Portuguese hospitals across the country, focusing on obstetric information, encompassing maternal data, various fetal data points, and the method of delivery in a retrospective manner. The inclusion criteria is all mothers with a registered outcome of the pregnancy from 2019 to 2020. There were no exclusion criteria. ach institution used identical \ac{ehr} software, ensuring the columns remained consistent. 

\subsubsection{Clinical Comparison}
The clinical comparison was performed by sending questionnaires to clinicians with a relationship with obstetrics in order to assess 10 patients, with only access to the variables used by the model and to answer three questions for each. The first was to give a score from 1-10 of how likely that patient would give birth through C-section, then to select the feature/variable that most influenced the decision and which feature they would require to make a better assessment. We sent the questionnaire to 20 people and obtained 6 answers, totaling 60 patient assessments. For these 10 patients, we also predicted the delivery type using our model in order to compare it with the clinicians' answers. These patients were new and were not seen by the model during the training phase.

\subsubsection{Analysis}

All null representations were standardized. Data were prepossessed by removing features with high missing rates ({\textgreater}90\% overall). The imputation process was performed using the KNN imputation method (for continuous variables) or a new category (NULLIMP) for categorical variables. Weight was categorized into percentiles defined specifically for Portuguese babies \cite{sousa-santosDevelopmentBirthweightStandard2016}. For the purpose of this study, the Birth Type was reduced to binary. All assisted birth were merged into vaginal birth and C-Section remained as the other class. Procedures and diagnoses were also used and were encoded as binary features, and we took the time to analyze each one of them in order to avoid leakage because there were procedures obviously related to C-sections and vaginal deliveries. Feature creation was performed through the free-text variable related to the prescribed medication. Medicine names were collected from it and converted into Anatomical Therapeutic Chemical (ATC) Classification Group level 4, which represents chemical subgroups. We also created some new features from data in the dataset, namely new categories related to the labour and condition of the baby. In addition, data quality issues were addressed, such as impossible values that were transformed into null values. The main variables affected by data quality were BMI/Weight and gestational age. The data were split into training and test sets in a 0.75:0.25 manner. From the overall datasets which comprised over 200 columns, only a few columns were selected (please see table \ref{tab:delivery_methods} in the results section). We used a mixture of features selected by surveying the literature \cite{irwindaMaternalFetalCharacteristics2021,deramonfernandezPredictionModeDelivery2022,parveenAnalysisCesareanSections2021} and features with a high correlation with the outcome. The tested models were Logistic Regression, Decision Tree, Random Forest, three different Boosting methods (as implemented by \ac{xgboost}, \ac{lightgbm} and \textit{scikit-learn}) and a linear model based on Stochastic Gradient Descent. The evaluation was performed with repeated stratified cross-validation with 10 splits and 2 repetitions, with two full cycles of dividing the training set into 10 equal parts and using 9 as the training set and 1 as the validation set. This rendered table \ref{tab:performancemetricsauc}. The \ac{api} for serving the prediction model was developed using FastAPI. We wrote all the code in Python 3.9.7.


\subsubsection{Ethical Considerations}
This study received Institutional Review Board approval from all hospitals included in this study with the following references: Centro Hospitalar São João; 08/2021, Centro Hospitalar Baixo Vouga; 12-03-2021, Unidade Local de Sa\'{u}de de Matosinho; 39/CES/JAS, Hospital da Senhora da Oliveira; 85/2020, Centro Hosptilar Tamega Sousa; 43/2020, Centro Hospitalar Vila Nova de Gaia/Espinho; 192/2020, Centro Hospitalar entre Douro e Vouga; CA-371/2020-0t\_MP/CC, Unidade Local de sa\'{u}de do Alto Minho; 11/2021. All methods were carried out in accordance with relevant guidelines and regulations. The need for informed consent was waived by the ethics committee. 
    